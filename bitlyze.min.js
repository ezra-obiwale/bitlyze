(function(t){t.fn.bitlyze=function(e){var a={},l=localStorage.getItem("btz");l&&(a=JSON.parse(l));var s={bitlyUrl:"https://api-ssl.bitly.com/v3/shorten",accessToken:"",urlDataKey:"url",callback:function(t){}};return t.extend(s,e),this.each(function(){if(!t(this).hasClass("bitlyzed")){var e=t(this),l=e.data(s.urlDataKey);if(a[l])return void(a[l].short?e.addClass("bitlyzed").data("url",a[l].short):a[l].queue.push(this));a[l]={queue:[this]};var r=s.bitlyUrl;r+=r.indexOf("?")===-1?"?":"&",r+="format=txt",r+="&access_token="+s.accessToken,r+="&longUrl="+encodeURIComponent(l),t.get(r,function(e){a[l].short=e;for(var r=0;r<a[l].queue.length;r++)t(a[l].queue[r]).addClass("bitlyzed").data(s.urlDataKey,e),s.callback.call(a[l].queue[r],e);a[l].queue=[],localStorage.setItem("btz",JSON.stringify(a))})}}),this}})(jQuery);